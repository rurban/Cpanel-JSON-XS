{"version":1,"ops":[{"type":1,"author":{"id":"65b6755d6747727bc7089f4061cb8ad439fd4d36"},"timestamp":1464720741,"metadata":{"github-id":"MDU6SXNzdWUxNTc3NDM2MjQ=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/67","origin":"github"},"title":"Decoding minimum integer on 32-bit Perl results in NV, not IV","message":"``` perl\nperl -MDevel::Peek -MCpanel::JSON::XS -wE '$i = -2147483648; Dump $i; $j=q[{\"i\" : -2147483648}]; $h = decode_json($j); Dump $h'\n\nSV = IV(0x7f97f1003640) at 0x7f97f1003650\n  REFCNT = 1\n  FLAGS = (IOK,pIOK)\n  IV = -2147483648\n\nSV = IV(0x7f97f1840cf8) at 0x7f97f1840d08\n  REFCNT = 1\n  FLAGS = (ROK)\n  RV = 0x7f97f0805498\n  SV = PVHV(0x7f97f080b320) at 0x7f97f0805498\n    REFCNT = 1\n    FLAGS = (SHAREKEYS)\n    ARRAY = 0x7f97f040a240  (0:7, 1:1)\n    hash quality = 100.0%\n    KEYS = 1\n    FILL = 1\n    MAX = 7\n    Elt \"i\" HASH = 0x39d503d9\n    SV = IV(0x7f97f0805668) at 0x7f97f0805678\n      REFCNT = 1\n      FLAGS = (IOK,pIOK)\n      IV = -2147483648\n```\n\nperl -V output:\n\n```\nSummary of my perl5 (revision 5 version 22 subversion 1) configuration:\n\n  Platform:\n    osname=linux, osvers=3.13.0-85-generic, archname=i686-linux\n    uname='linux dev32 3.13.0-85-generic #129-ubuntu smp thu mar 17 20:50:41 utc 2016 i686 i686 i686 gnulinux '\n    config_args='-Dprefix=/home/xdg/.plenv/versions/22.1 -de -Dusedevel -Dman1dir=none -Dman3dir=none -Dusemorebits -Doptimize=-g -Uusemorebits -A'eval:scriptdir=/home/xdg/.plenv/versions/22.1/bin''\n    hint=recommended, useposix=true, d_sigaction=define\n    useithreads=undef, usemultiplicity=undef\n    use64bitint=undef, use64bitall=undef, uselongdouble=undef\n    usemymalloc=n, bincompat5005=undef\n  Compiler:\n    cc='cc', ccflags ='-fwrapv -fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64',\n    optimize='-g',\n    cppflags='-fwrapv -fno-strict-aliasing -pipe -fstack-protector -I/usr/local/include'\n    ccversion='', gccversion='4.8.4', gccosandvers=''\n    intsize=4, longsize=4, ptrsize=4, doublesize=8, byteorder=1234, doublekind=3\n    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=12, longdblkind=3\n    ivtype='long', ivsize=4, nvtype='double', nvsize=8, Off_t='off_t', lseeksize=8\n    alignbytes=4, prototype=define\n  Linker and Libraries:\n    ld='cc', ldflags =' -fstack-protector -L/usr/local/lib'\n    libpth=/usr/local/lib /usr/lib/gcc/i686-linux-gnu/4.8/include-fixed /usr/include/i386-linux-gnu /usr/lib /lib/i386-linux-gnu /lib/../lib /usr/lib/i386-linux-gnu /usr/lib/../lib /lib\n    libs=-lpthread -lnsl -ldl -lm -lcrypt -lutil -lc\n    perllibs=-lpthread -lnsl -ldl -lm -lcrypt -lutil -lc\n    libc=libc-2.19.so, so=so, useshrplib=false, libperl=libperl.a\n    gnulibc_version='2.19'\n  Dynamic Linking:\n    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags='-Wl,-E'\n    cccdlflags='-fPIC', lddlflags='-shared -g -L/usr/local/lib -fstack-protector'\n\n\nCharacteristics of this binary (from libperl): \n  Compile-time options: HAS_TIMES PERLIO_LAYERS PERL_DONT_CREATE_GVSV\n                        PERL_HASH_FUNC_ONE_AT_A_TIME_HARD PERL_MALLOC_WRAP\n                        PERL_NEW_COPY_ON_WRITE PERL_PRESERVE_IVUV\n                        PERL_USE_DEVEL USE_LARGE_FILES USE_LOCALE\n                        USE_LOCALE_COLLATE USE_LOCALE_CTYPE\n                        USE_LOCALE_NUMERIC USE_LOCALE_TIME USE_PERLIO\n                        USE_PERL_ATOF\n  Locally applied patches:\n    Devel::PatchPerl 1.40\n  Built under linux\n  Compiled at Apr  8 2016 14:16:13\n  %ENV:\n    PERL_EXTUTILS_AUTOINSTALL=\"--defaultdeps\"\n    PERL_MONGO_WITH_ASSERTS=\"1\"\n  @INC:\n    /home/xdg/.plenv/versions/22.1/lib/perl5/site_perl/5.22.1/i686-linux\n    /home/xdg/.plenv/versions/22.1/lib/perl5/site_perl/5.22.1\n    /home/xdg/.plenv/versions/22.1/lib/perl5/5.22.1/i686-linux\n    /home/xdg/.plenv/versions/22.1/lib/perl5/5.22.1\n    .\n```\n\nI suspect this cast is doing the wrong thing: https://github.com/rurban/Cpanel-JSON-XS/blob/master/XS.xs#L2302\n\nMaybe it should be `uv \u003c (UV)IV_MAX + 1`?","files":null}]}