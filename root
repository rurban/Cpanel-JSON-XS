{"version":1,"ops":[{"type":1,"author":{"id":"65b6755d6747727bc7089f4061cb8ad439fd4d36"},"timestamp":1488818845,"metadata":{"github-id":"MDU6SXNzdWUyMTIxODEzNDE=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/83","origin":"github"},"title":"Tests fail on linux-s390x-ld","message":"Here is the perl -V:\n\n```\nSummary of my perl5 (revision 5 version 24 subversion 0) configuration:\n\n  Platform:\n    osname=linux, osvers=3.10.0-327.10.1.el7.s390x, archname=s390x-linux-ld\n    uname='linux rhel72-z-dev.maristisv.build.10gen.cc 3.10.0-327.10.1.el7.s390x #1 smp sat jan 23 04:55:57 est 2016 s390x s390x s390x gnulinux '\n    config_args='-Dprefix=/home/david.golden/opt/perl/24.0ld -de -Dusemorebits -Doptimize=-g -A'eval:scriptdir=/home/david.golden/opt/perl/24.0ld/bin''\n    hint=recommended, useposix=true, d_sigaction=define\n    useithreads=undef, usemultiplicity=undef\n    use64bitint=define, use64bitall=define, uselongdouble=define\n    usemymalloc=n, bincompat5005=undef\n  Compiler:\n    cc='cc', ccflags ='-fwrapv -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/local/include -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64',\n    optimize='-g',\n    cppflags='-fwrapv -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/local/include'\n    ccversion='', gccversion='4.8.5 20150623 (Red Hat 4.8.5-4)', gccosandvers=''\n    intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=87654321, doublekind=4\n    d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16, longdblkind=2\n    ivtype='long', ivsize=8, nvtype='long double', nvsize=16, Off_t='off_t', lseeksize=8\n    alignbytes=8, prototype=define\n  Linker and Libraries:\n    ld='cc', ldflags =' -fstack-protector-strong -L/usr/local/lib'\n    libpth=/usr/local/lib /usr/lib /lib/../lib64 /usr/lib/../lib64 /lib /lib64 /usr/lib64 /usr/local/lib64\n    libs=-lpthread -lnsl -lgdbm -ldb -ldl -lm -lcrypt -lutil -lc -lgdbm_compat\n    perllibs=-lpthread -lnsl -ldl -lm -lcrypt -lutil -lc\n    libc=libc-2.17.so, so=so, useshrplib=false, libperl=libperl.a\n    gnulibc_version='2.17'\n  Dynamic Linking:\n    dlsrc=dl_dlopen.xs, dlext=so, d_dlsymun=undef, ccdlflags='-Wl,-E'\n    cccdlflags='-fPIC', lddlflags='-shared -g -L/usr/local/lib -fstack-protector-strong'\n\n\nCharacteristics of this binary (from libperl):\n  Compile-time options: HAS_TIMES PERLIO_LAYERS PERL_COPY_ON_WRITE\n                        PERL_DONT_CREATE_GVSV\n                        PERL_HASH_FUNC_ONE_AT_A_TIME_HARD PERL_MALLOC_WRAP\n                        PERL_PRESERVE_IVUV USE_64_BIT_ALL USE_64_BIT_INT\n                        USE_LARGE_FILES USE_LOCALE USE_LOCALE_COLLATE\n                        USE_LOCALE_CTYPE USE_LOCALE_NUMERIC USE_LOCALE_TIME\n                        USE_LONG_DOUBLE USE_PERLIO USE_PERL_ATOF\n  Locally applied patches:\n\tDevel::PatchPerl 1.48\n  Built under linux\n  Compiled at Mar  6 2017 15:21:03\n  @INC:\n    /home/david.golden/opt/perl/24.0ld/lib/site_perl/5.24.0/s390x-linux-ld\n    /home/david.golden/opt/perl/24.0ld/lib/site_perl/5.24.0\n    /home/david.golden/opt/perl/24.0ld/lib/5.24.0/s390x-linux-ld\n    /home/david.golden/opt/perl/24.0ld/lib/5.24.0\n    .\n```\n\nHere is the test output:\n\n```\nPERL_DL_NONLAZY=1 \"/home/david.golden/opt/perl/24.0ld/bin/perl\" \"-MExtUtils::Command::MM\" \"-MTest::Harness\" \"-e\" \"undef *Test::Harness::Switches; test_harness(0, 'blib/lib', 'blib/arch')\" t/*.t\nt/00_load.t ................. ok\nt/01_utf8.t ................. ok\nt/02_error.t ................ ok\nt/03_types.t ................ Failed 4/85 subtests\nt/04_dwiw_encode.t .......... ok\nt/05_dwiw_decode.t .......... 1/7 # Failed test 4 in t/05_dwiw_decode.t at line 65\n#  t/05_dwiw_decode.t line 65 is:     ok($data == 50);\n# Failed test 5 in t/05_dwiw_decode.t at line 69\n#  t/05_dwiw_decode.t line 69 is:     ok($data == 5000);\n# Failed test 6 in t/05_dwiw_decode.t at line 73\n#  t/05_dwiw_decode.t line 73 is:     ok($data == 50);\n# Failed test 7 in t/05_dwiw_decode.t at line 77\n#  t/05_dwiw_decode.t line 77 is:     ok($data == 0.5);\nt/05_dwiw_decode.t .......... Failed 4/7 subtests\nt/06_pc_pretty.t ............ ok\nt/07_pc_esc.t ............... ok\nt/08_pc_base.t .............. 1/20\n#   Failed test at t/08_pc_base.t line 66.\n#          got: '[{\"foo\":[1,2,3]},-3.16919542507885714463286479947541e-4936,{\"a\":\"b\"}]'\n#     expected: '[{\"foo\":[1,2,3]},-0.12,{\"a\":\"b\"}]'\n# Looks like you failed 1 test of 20.\nt/08_pc_base.t .............. Dubious, test returned 1 (wstat 256, 0x100)\nFailed 1/20 subtests\nt/08_pc_base_nv.t ........... 1/1\n#   Failed test at t/08_pc_base_nv.t line 9.\n#          got: '-6.30257943331475826710805676990335e-4933'\n#     expected: '-0.12'\n# Looks like you failed 1 test of 1.\nt/08_pc_base_nv.t ........... Dubious, test returned 1 (wstat 256, 0x100)\nFailed 1/1 subtests\nt/09_pc_extra_number.t ...... 1/6\n#   Failed test 'normal 0.1'\n#   at t/09_pc_extra_number.t line 19.\n#          got: '5.25265615208348278843929453765997e-4934'\n#     expected: '0.1'\n\n#   Failed test 'normal 0.1'\n#   at t/09_pc_extra_number.t line 34.\n#          got: '5.25265615208348278843929453765997e-4934'\n#     expected: '0.1'\n# Looks like you failed 2 tests of 6.\nt/09_pc_extra_number.t ...... Dubious, test returned 2 (wstat 512, 0x200)\nFailed 2/6 subtests\nt/104_sortby.t .............. ok\nt/105_esc_slash.t ........... ok\nt/106_allow_barekey.t ....... ok\nt/107_allow_singlequote.t ... ok\nt/108_decode.t .............. ok\nt/109_encode.t .............. ok\nt/10_pc_keysort.t ........... ok\nt/110_bignum.t .............. ok\nt/112_upgrade.t ............. ok\nt/113_overloaded_eq.t ....... ok\nt/114_decode_prefix.t ....... ok\nt/115_tie_ixhash.t .......... ok\nt/116_incr_parse_fixed.t .... ok\nt/117_numbers.t ............. ok\nt/11_pc_expo.t .............. 1/8\n#   Failed test 'digit -12.34'\n#   at t/11_pc_expo.t line 15.\n#          got: '-1.35508902104513438714279222413721e-4935'\n#     expected: '-12.34'\n\n#   Failed test 'digit -12.34'\n#   at t/11_pc_expo.t line 17.\n#          got: '[-1.35508902104513438714279222413721e-4935]'\n#     expected: '[-12.34]'\n\n#   Failed test 'digit -1.234e5'\n#   at t/11_pc_expo.t line 21.\n#          got: '-6.00540256404840243733788868724594e-4935'\n#     expected: '-123400'\n\n#   Failed test 'digit -1.234e5'\n#   at t/11_pc_expo.t line 23.\n#          got: '[-6.00540256404840243733788868724594e-4935]'\n#     expected: '[-123400.0]'\n\n#   Failed test 'digit 1.23E-4'\n#   at t/11_pc_expo.t line 27.\n#          got: '5.90274610996210495979094358982275e-4936'\n#     expected: '0.000123'\n\n#   Failed test 'digit 1.23E-4'\n#   at t/11_pc_expo.t line 32.\n#          got: '[5.90274610996210495979094358982275e-4936]'\n#     expected: '[0.000123]'\n\n#   Failed test 'digit 1.01e+30'\n#   at t/11_pc_expo.t line 37.\n#          got: '2.56641135215743693919214906325084e-4937'\n#     expected: '1010000000000000000000000000000'\n\n#   Failed test 'digit (64bit ld)'\n#   at t/11_pc_expo.t line 42.\n#                   '[2.56641135215743693919214906325084e-4937]'\n#     doesn't match '(?^:^\\[(1010000000000000000000000000000\\.0|1.01[Ee]\\+0?30)\\])'\n# Looks like you failed 8 tests of 8.\nt/11_pc_expo.t .............. Dubious, test returned 8 (wstat 2048, 0x800)\nFailed 8/8 subtests\nt/12_blessed.t .............. ok\nt/13_limit.t ................ ok\nt/14_latin1.t ............... ok\nt/15_prefix.t ............... ok\nt/16_tied.t ................. ok\nt/17_relaxed.t .............. ok\nt/18_json_checker.t ......... 1/39\n#   Failed test at t/18_json_checker.t line 28.\n#          got: '[\"JSON Test Pattern pass1\",{\"object with 1 member\":[\"array with 1 element\"]},{},[],-42,true,false,null,{\"\":1.18660501218249875018083935967561e-4935,\" s p a c e d \":[1,2,3,4,5,6,7],\"# -- --\u003e */\":\" \",\"/\\\\\\\"쫾몾ꮘﳞ볚\\b\\f\\n\\r\\t`1~!@#$%^\u0026*()_+-=[]{}|;:',./\u003c\u003e?\":\"A key can be any string\",\"0123456789\":\"digit\",\"ALPHA\":\"ABCDEFGHIJKLMNOPQRSTUVWYZ\",\"E\":2.68208922025727813983415354923549e-4925,\"address\":\"50 St. James Street\",\"alpha\":\"abcdefghijklmnopqrstuvwyz\",\"array\":[],\"backslash\":\"\\\\\",\"comment\":\"// /* \u003c!-- --\",\"compact\":[1,2,3,4,5,6,7],\"controls\":\"\\b\\f\\n\\r\\t\",\"digit\":\"0123456789\",\"e\":8.45973301568858199151605747418989e-4925,\"false\":false,\"hex\":\"ģ䕧覫췯ꯍ\",\"integer\":1234567890,\"jsontext\":\"{\\\"object with 1 member\\\":[\\\"array with 1 element\\\"]}\",\"null\":null,\"object\":{},\"one\":1,\"quote\":\"\\\"\",\"quotes\":\"\u0026#34; \\\" %22 0x22 034 \u0026#x22;\",\"real\":-1.20250596775408253435797582532808e-4933,\"slash\":\"/ \u0026 /\",\"space\":\" \",\"special\":\"`1~!@#$%^\u0026*()_+-={':[,]}|;.\u003c/\u003e?\",\"true\":true,\"url\":\"http://www.JSON.org/\",\"zero\":0},1.21166111567281605081755384892012e-4918,1.47246923088784606327084429679275e-4934,1.54555920797897005956604451626232e-4934,1066,3.12701363493860116211386799439592e-4933,2.41900470698635500721445680868542e-4934,1.61864609101989091113820320267724e-4934,1.61864609101989091113820320267724e-4934,3.80640801589434605971870570824783e-4934,3.80640801589434605971870570824783e-4934,\"rosebud\"]'\n#     expected: '[\"JSON Test Pattern pass1\",{\"object with 1 member\":[\"array with 1 element\"]},{},[],-42,true,false,null,{\"\":6.01722128925185313825197114973235e-4927,\" s p a c e d \":[1,2,3,4,5,6,7],\"# -- --\u003e */\":\" \",\"/\\\\\\\"쫾몾ꮘﳞ볚\\b\\f\\n\\r\\t`1~!@#$%^\u0026*()_+-=[]{}|;:',./\u003c\u003e?\":\"A key can be any string\",\"0123456789\":\"digit\",\"ALPHA\":\"ABCDEFGHIJKLMNOPQRSTUVWYZ\",\"E\":2.56523663271138492080934243787976e-4937,\"address\":\"50 St. James Street\",\"alpha\":\"abcdefghijklmnopqrstuvwyz\",\"array\":[],\"backslash\":\"\\\\\",\"comment\":\"// /* \u003c!-- --\",\"compact\":[1,2,3,4,5,6,7],\"controls\":\"\\b\\f\\n\\r\\t\",\"digit\":\"0123456789\",\"e\":3.51563760872683791232978871820097e-4945,\"false\":false,\"hex\":\"ģ䕧覫췯ꯍ\",\"integer\":1234567890,\"jsontext\":\"{\\\"object with 1 member\\\":[\\\"array with 1 element\\\"]}\",\"null\":null,\"object\":{},\"one\":1,\"quote\":\"\\\"\",\"quotes\":\"\u0026#34; \\\" %22 0x22 034 \u0026#x22;\",\"real\":-2.53342763249693597022451488506622e-4933,\"slash\":\"/ \u0026 /\",\"space\":\" \",\"special\":\"`1~!@#$%^\u0026*()_+-={':[,]}|;.\u003c/\u003e?\",\"true\":true,\"url\":\"http://www.JSON.org/\",\"zero\":0},1.42352291395488459918987332653018e-4936,2.51527631361342832183240858363078e-4935,2.54094239844621851478604548146775e-4935,1066,2.56660848327900847423103025258063e-4937,2.8476664893502937055119928924673e-4953,2.56660848327900847423103025258063e-4937,2.56660848327900847423103025258063e-4937,5.13321696655801694846206050516126e-4937,5.13321696655801694846206050516126e-4937,\"rosebud\"]'\n# Looks like you failed 1 test of 39.\nt/18_json_checker.t ......... Dubious, test returned 1 (wstat 256, 0x100)\nFailed 1/39 subtests\nt/19_incr.t ................. ok\nt/20_faihu.t ................ ok\nt/20_unknown.t .............. skipped: JSON 2.09 required for cross testing\nt/21_evans.t ................ ok\nt/22_comment_at_eof.t ....... ok\nt/23_array_ctx.t ............ ok\nt/24_freeze_recursion.t ..... ok\nt/25_boolean.t .............. ok\nt/30_jsonspec.t ............. ok\nt/31_bom.t .................. ok\nt/52_object.t ............... ok\nt/53_readonly.t ............. ok\nt/54_stringify.t ............ skipped: JSON required for cross testing\nt/55_modifiable.t ........... ok\nt/96_interop.t .............. skipped: JSON::XS and JSON required for testing interop\nt/96_mojo.t ................. skipped: Mojo::JSON required for testing interop\nt/97_unshare_hek.t .......... ok\nt/98_56only.t ............... 1/4\n#   Failed test 'digit -12.34'\n#   at t/98_56only.t line 34.\n#          got: '-1.78606107902447879107856539168601e-4932'\n#     expected: '-12.34'\n\n#   Failed test 'digit -12.34'\n#   at t/98_56only.t line 36.\n#          got: '[-1.78606107902447879107856539168601e-4932]'\n#     expected: '[-12.34]'\n# Looks like you failed 2 tests of 4.\nt/98_56only.t ............... Dubious, test returned 2 (wstat 512, 0x200)\nFailed 2/4 subtests\nt/99_binary.t ............... ok\nt/gh70-asan.t ............... ok\nt/z_kwalitee.t .............. skipped: Class::XSAccessor required for Test::Kwalitee\nt/z_leaktrace.t ............. skipped: require Test::LeakTrace\nt/z_meta.t .................. skipped: Test::CPAN::Meta 0.12 not available for testing\nt/z_perl_minimum_version.t .. skipped: Perl::MinimumVersion 1.20 not available for testing\nt/z_pod-coverage.t .......... skipped: Test::Pod::Coverage 1.04 required for testing POD coverage\nt/z_pod-spell-mistakes.t .... skipped: Pod::Spell::CommonMistakes required\nt/z_pod-spelling.t .......... skipped: Test::Spelling required\nt/z_pod.t ................... skipped: Test::Pod 1.00 required for testing POD\nt/zero-mojibake.t ........... ok\n\nTest Summary Report\n-------------------\nt/03_types.t              (Wstat: 0 Tests: 85 Failed: 4)\n  Failed tests:  16-18, 24\nt/05_dwiw_decode.t        (Wstat: 0 Tests: 7 Failed: 4)\n  Failed tests:  4-7\nt/08_pc_base.t            (Wstat: 256 Tests: 20 Failed: 1)\n  Failed test:  13\n  Non-zero exit status: 1\nt/08_pc_base_nv.t         (Wstat: 256 Tests: 1 Failed: 1)\n  Failed test:  1\n  Non-zero exit status: 1\nt/09_pc_extra_number.t    (Wstat: 512 Tests: 6 Failed: 2)\n  Failed tests:  2, 6\n  Non-zero exit status: 2\nt/11_pc_expo.t            (Wstat: 2048 Tests: 8 Failed: 8)\n  Failed tests:  1-8\n  Non-zero exit status: 8\nt/18_json_checker.t       (Wstat: 256 Tests: 39 Failed: 1)\n  Failed test:  35\n  Non-zero exit status: 1\nt/98_56only.t             (Wstat: 512 Tests: 4 Failed: 2)\n  Failed tests:  3-4\n  Non-zero exit status: 2\nFiles=62, Tests=2311,  4 wallclock secs ( 0.29 usr  0.09 sys +  1.57 cusr  0.16 csys =  2.11 CPU)\nResult: FAIL\nFailed 8/62 test programs. 23/2311 subtests failed.\nmake: *** [test_dynamic] Error 255\n```\n\nI have some minor suspicions about the long double type, as I've seen reports that it could be 8 bytes, not 16, but I've also seen it the other way and I've seen indications that it could be compiler specific. See:\n\n* [Porting applications to Linux for System Z](https://www.ibm.com/developerworks/library/l-systemz/index.html)\n* [ELF Application Binary Interface Supplement](http://legacy.redhat.com/pub/redhat/linux/7.1/es/os/s390x/doc/lzsabi0.pdf)\n* [S/390 and zSeries Options for gcc](https://gcc.gnu.org/onlinedocs/gcc-4.5.1/gcc/S_002f390-and-zSeries-Options.html)\n\nThis could be totally unrelated, but it was perplexing.\n\nI don't know if I can offer shell access to our Z Series machine, but I can inquire if you think you need access to diagnose the problem.","files":null}]}