{"version":1,"ops":[{"type":1,"author":{"id":"9bc4032fe2eafeed0467f2535d4d701527283659"},"timestamp":1554347947,"metadata":{"github-id":"MDU6SXNzdWU0MjkwNjQ1MTY=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/128","origin":"github"},"title":"Segfault when overloading array","message":"While overloading array we get segfault on perl-5.26.1, Cpanel::JSON::XS-4.11\n\nSame code works properly on perl-5.16, Cpanel::JSON::XS-3.0115 and perl-5.18, Cpanel::JSON::XS-3.0213\n\nHere's the code,\n`#!/usr/bin/perl\n\nuse JSON -convert_blessed_universally;\nuse Cpanel::JSON::XS ();\n\nour $Json = Cpanel::JSON::XS-\u003enew-\u003eallow_nonref-\u003eallow_blessed-\u003econvert_blessed-\u003ecanonical;\n\nmy $ar = [\n  {\n    'closeTime' =\u003e '18:00',\n    'openTime' =\u003e '09:00',\n    'closeDay' =\u003e 'MONDAY',\n    'openDay' =\u003e 'MONDAY'\n  },\n];\n\nmy $var = bless( $ar, 'TestArray' ); \n\nprint \"\\$var : \",$Json-\u003eencode($var),\"\\n\";\n\npackage TestArray;\n\nuse overload\n    '\"\"'  =\u003e sub { $Json-\u003eencode($_[0]) },\n    bool  =\u003e sub { !! @{$_[0]} },\n    '0+'  =\u003e sub { scalar(@{$_[0]}) },\n    '+'   =\u003e sub { scalar(@{$_[0]}) + $_[1] },\n    '-'   =\u003e sub { $_[2] ? $_[1] - scalar(@{$_[0]}) : scalar(@{$_[0]}) - $_[1] },\n    '*'   =\u003e sub { scalar(@{$_[0]}) * $_[1] },\n\n    '\u003c=\u003e' =\u003e sub { $_[2] ? $_[1] \u003c=\u003e scalar(@{$_[0]})  : scalar(@{$_[0]})  \u003c=\u003e $_[1] },\n    'cmp' =\u003e sub { $_[2] ? $_[1] cmp scalar(@{$_[0]})  : scalar(@{$_[0]})  cmp $_[1] },\n    '~~'  =\u003e sub { $_[2] ? $_[1] ~~ [ @{$_[0]} ] : [ @{$_[0]} ] ~~ $_[1] },\n    ;\n`\nOutput on servers running perl5.16 and perl5.18,\n$var : [{\"closeDay\":\"MONDAY\",\"closeTime\":\"18:00\",\"openDay\":\"MONDAY\",\"openTime\":\"09:00\"}]\n\nTrace from GDB,\n`(gdb) bt full\n#0  0x00005555555b3564 in Perl_gv_fetchmethod_pvn_flags ()\nNo symbol table info available.\n#1  0x00007ffff6845b0d in encode_sv () from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#2  0x00007ffff68477b5 in encode_json () from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#3  0x00007ffff6847b54 in XS_Cpanel__JSON__XS_encode ()\n   from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#4  0x00005555556334f1 in Perl_pp_entersub ()\nNo symbol table info available.\n#5  0x000055555562b316 in Perl_runops_standard ()\nNo symbol table info available.\n#6  0x00005555555b4a8e in Perl_amagic_call ()\nNo symbol table info available.\n#7  0x00007ffff68409ab in encode_stringify () from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#8  0x00007ffff6845db9 in encode_sv () from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#9  0x00007ffff68477b5 in encode_json () from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#10 0x00007ffff6847b54 in XS_Cpanel__JSON__XS_encode ()\n   from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so\nNo symbol table info available.\n#11 0x00005555556334f1 in Perl_pp_entersub ()\nNo symbol table info available.\n#12 0x000055555562b316 in Perl_runops_standard ()\nNo symbol table info available.\n#13 0x00005555555b4a8e in Perl_amagic_call ()\nNo symbol table info available.\n#14 0x00007ffff68409ab in encode_stringify () from /usr/lib/perl5/vendor_perl/5.26.1/x86_64-linux-thread-multi/auto/Cpanel/JSON/XS/XS.so`","files":null}]}