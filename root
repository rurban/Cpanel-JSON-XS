{"version":1,"ops":[{"type":1,"author":{"id":"2e38d6655cda9408d77579d0366cbb76d1470cb7"},"timestamp":1521378009,"metadata":{"github-id":"MDU6SXNzdWUzMDYyMzgyMDM=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/106","origin":"github"},"title":"Test fails under ASAN","message":"A test committed as part of https://github.com/rurban/Cpanel-JSON-XS/issues/70 is failing to execute under ASAN ( with output very similar to the original issue ).\n\nIf this failure is deliberate/expected - the test must be moved to `xt/...` as to not trip up stock `cpan(m)` installations.\n\nPerl is produced on linux via: `perlbrew install -v -j10 --as 5.24.3_asan -Dusethreads -Accflags=\"-fsanitize=address -g -O2\" -Aldflags=\"-fsanitize=address -g -O2\" perl-5.24.3`\n\n```\nt/gh70-asan.t ............... =================================================================\n==19131==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6040000a7f30 at pc 0x7f961b51b323 bp 0x7ffd1060a5e0 sp 0x7ffd1060a5d8\nREAD of size 17 at 0x6040000a7f30 thread T0\n    #0 0x7f961b51b322 in XS_Cpanel__JSON__XS_new /home/rabbit/.cpanm/work/1521377489.18808/Cpanel-JSON-XS-4.02/XS.xs:3976\n    #1 0x60d72c in Perl_pp_entersub /home/rabbit/perl5/perlbrew/build/perl-5.24.3/pp_hot.c:3988\n    #2 0x5f5a15 in Perl_runops_standard /home/rabbit/perl5/perlbrew/build/perl-5.24.3/run.c:41\n    #3 0x489728 in S_run_body /home/rabbit/perl5/perlbrew/build/perl-5.24.3/perl.c:2478\n    #4 0x489728 in perl_run /home/rabbit/perl5/perlbrew/build/perl-5.24.3/perl.c:2406\n    #5 0x421b1d in main /home/rabbit/perl5/perlbrew/build/perl-5.24.3/perlmain.c:116\n    #6 0x7f961e88cb44 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21b44)\n    #7 0x4220b4 (/home/rabbit/perl5/perlbrew/perls/5.24.3_asan/bin/perl+0x4220b4)\n\n0x6040000a7f33 is located 0 bytes to the right of 35-byte region [0x6040000a7f10,0x6040000a7f33)\nallocated by thread T0 here:\n    #0 0x7f961f9de73f in malloc (/usr/lib/x86_64-linux-gnu/libasan.so.1+0x5473f)\n    #1 0x59d231 in Perl_safesysmalloc /home/rabbit/perl5/perlbrew/build/perl-5.24.3/util.c:153\n\nSUMMARY: AddressSanitizer: heap-buffer-overflow /home/rabbit/.cpanm/work/1521377489.18808/Cpanel-JSON-XS-4.02/XS.xs:3976 XS_Cpanel__JSON__XS_new\nShadow bytes around the buggy address:\n  0x0c088000cf90: fa fa 00 00 00 00 00 fa fa fa 00 00 00 00 00 fa\n  0x0c088000cfa0: fa fa 00 00 00 00 00 02 fa fa fd fd fd fd fd fd\n  0x0c088000cfb0: fa fa fd fd fd fd fd fd fa fa fd fd fd fd fd fd\n  0x0c088000cfc0: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fa\n  0x0c088000cfd0: fa fa 00 00 00 00 00 00 fa fa fd fd fd fd fd fa\n=\u003e0x0c088000cfe0: fa fa 00 00 00 00[03]fa fa fa 00 00 00 00 05 fa\n  0x0c088000cff0: fa fa fd fd fd fd fd fd fa fa 00 00 00 00 00 00\n  0x0c088000d000: fa fa 00 00 00 00 00 00 fa fa fd fd fd fd fd fd\n  0x0c088000d010: fa fa fd fd fd fd fd fd fa fa fd fd fd fd fd fd\n  0x0c088000d020: fa fa fd fd fd fd fd fa fa fa fd fd fd fd fd fd\n  0x0c088000d030: fa fa 00 00 00 00 00 00 fa fa fd fd fd fd fd fd\nShadow byte legend (one shadow byte represents 8 application bytes):\n  Addressable:           00\n  Partially addressable: 01 02 03 04 05 06 07 \n  Heap left redzone:       fa\n  Heap right redzone:      fb\n  Freed heap region:       fd\n  Stack left redzone:      f1\n  Stack mid redzone:       f2\n  Stack right redzone:     f3\n  Stack partial redzone:   f4\n  Stack after return:      f5\n  Stack use after scope:   f8\n  Global redzone:          f9\n  Global init order:       f6\n  Poisoned by user:        f7\n  Contiguous container OOB:fc\n  ASan internal:           fe\n==19131==ABORTING\n```","files":null}]}