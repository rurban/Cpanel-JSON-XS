{"version":1,"ops":[{"type":1,"author":{"id":"91e41b119e7e533de326580fd48f9281bdfb3d49"},"timestamp":1553876186,"metadata":{"github-id":"MDU6SXNzdWU0MjcwNjY4ODM=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/127","origin":"github"},"title":"Segfault on Cpanel::JSON::XS destroy","message":"Hello, the problem didn't disappear with the newest version. We are now running 4.11 and we get the following output with gdb on my core dump. I have a stron hint that Search::Elasticsearch/HTTP::Tiny are in play here as well. I've seem to be able to trigger this if I fake an API that just returns '{}'. \n\n```\n(gdb) bt full\n#0  S_SvREFCNT_dec (sv=0x101) at /usr/local/lib/perl5/5.28.1/x86_64-linux-gnu/CORE/inline.h:187\nrc = \u003coptimized out\u003e\n#1  XS_Cpanel__JSON__XS_DESTROY (cv=\u003coptimized out\u003e) at XS.xs:4418\nself = 0x55fdfd875340\nsp = \u003coptimized out\u003e\nax = \u003coptimized out\u003e\nmark = \u003coptimized out\u003e\nitems = \u003coptimized out\u003e\n__PRETTY_FUNCTION__ = \"XS_Cpanel__JSON__XS_DESTROY\"\n#2  0x00007f67bf921f78 in Perl_pp_entersub () at pp_hot.c:5232\nis_scalar = \u003coptimized out\u003e\nsp = \u003coptimized out\u003e\nsv = 0x55fdc701c2c0\ngv = 0xf7ee15433c419d00\ncv = \u003coptimized out\u003e\nold_savestack_ix = \u003coptimized out\u003e\n__PRETTY_FUNCTION__ = \"Perl_pp_entersub\"\n#3  0x00007f67bf845d2f in Perl_call_sv (sv=sv@entry=0x55fdc701c2c0, flags=flags@entry=45) at perl.c:3021\nold_cxix = -1\nmyop = {op_next = 0x0, op_sibparent = 0x0, op_ppaddr = 0x0, op_targ = 0, op_type = 0, op_opt = 0, op_slabbed = 0, op_savefree = 0, op_static = 0, op_folded = 0, op_moresib = 0, op_spare = 0, op_flags = 65 'A', op_private = 0 '\\000', op_first = 0x0, op_other = 0x7ffd7a15ab50}\nmethod_op = {op_next = 0x8, op_sibparent = 0x7f67bfa87700 \u003cS_destroy\u003e, op_ppaddr = 0x0, op_targ = 0, op_type = 288, op_opt = 1, op_slabbed = 1, op_savefree = 0, op_static = 0, op_folded = 1, op_moresib = 1, op_spare = 1, op_flags = 234 '\\352', op_private = 198 '\\306', op_u = {op_first = 0x7, op_meth_sv = 0x7},\nop_rclass_sv = 0x55fdc6fe3a68}\noldmark = 0\nretval = 0\noldcatch = \u003coptimized out\u003e\nret = \u003coptimized out\u003e\noldop = 0x55fdebbe5b68\ncur_env = {je_prev = 0x7ffd7a15afd0, je_buf = {{__jmpbuf = {140083577537352, -6949293319880246749, 140726651693904, 94548424242224, 94549152200120, 94549368581568, -3778981179092698589, -3838237311138596317}, __mask_was_saved = 0, __saved_mask = {__val = {140083573847808, 94548453636712, 0, 0, 94549368581568,\n140083571563595, 0, 0, 1, 0, 94545115086848, 94548453843952, 281994626280752, 94548453868368, 2, 18446744069414584320}}}}, je_ret = 0, je_mustcatch = false, je_old_delaymagic = 0, je_old_stack_hwm = 2}\n__PRETTY_FUNCTION__ = \"Perl_call_sv\"\n#4  0x00007f67bf92a320 in S_curse (sv=sv@entry=0x55fdfd872dc0, check_refcnt=check_refcnt@entry=true) at sv.c:6938\ntmpref = \u003coptimized out\u003e\ndestructor = 0x55fdc701c2c0\nmeta = \u003coptimized out\u003e\nsp = \u003coptimized out\u003e\nstash = 0x55fdc6fe3a68\n__PRETTY_FUNCTION__ = \"S_curse\"\n#5  0x00007f67bf92ad52 in Perl_sv_clear (orig_sv=orig_sv@entry=0x55fdfd3e77d0) at sv.c:6532\nstash = \u003coptimized out\u003e\ntype = 7\nsv_type_details = \u003coptimized out\u003e\niter_sv = \u003coptimized out\u003e\nnext_sv = 0x0\nsv = 0x55fdfd872dc0\nhash_index = 7\n__PRETTY_FUNCTION__ = \"Perl_sv_clear\"\n#6  0x00007f67bf92be95 in Perl_sv_free2 (sv=sv@entry=0x55fdfd3e77d0, rc=\u003coptimized out\u003e) at sv.c:7039\n__PRETTY_FUNCTION__ = \"Perl_sv_free2\"\n#7  0x00007f67bf943d38 in S_SvREFCNT_dec_NN (sv=0x55fdfd3e77d0) at inline.h:202\nrc = \u003coptimized out\u003e\n#8  Perl_sv_rvweaken (sv=0x55fdfd3df420) at sv.c:5899\ntsv = 0x55fdfd3e77d0\n__PRETTY_FUNCTION__ = \"Perl_sv_rvweaken\"\n#9  0x00007f67be4aa5d1 in XS_Scalar__Util_weaken (cv=0x55fdc54396e0) at ListUtil.xs:1357\nsv = \u003coptimized out\u003e\nsp = \u003coptimized out\u003e\nax = \u003coptimized out\u003e\nmark = \u003coptimized out\u003e\nitems = \u003coptimized out\u003e\n#10 0x00007f67bf921f78 in Perl_pp_entersub () at pp_hot.c:5232\nis_scalar = \u003coptimized out\u003e\nsp = \u003coptimized out\u003e\nsv = 0x55fdebb30be0\ngv = 0x0\ncv = \u003coptimized out\u003e\nold_savestack_ix = \u003coptimized out\u003e\n__PRETTY_FUNCTION__ = \"Perl_pp_entersub\"\n#11 0x00007f67bf8dd2c7 in Perl_runops_debug () at dump.c:2536\norig_stack_hwm = 2\n#12 0x00007f67bf845f21 in Perl_call_sv (sv=sv@entry=0x55fdebbdb7b0, flags=flags@entry=45) at perl.c:3021\nold_cxix = -1\nmyop = {op_next = 0x0, op_sibparent = 0x0, op_ppaddr = 0x0, op_targ = 0, op_type = 0, op_opt = 0, op_slabbed = 0, op_savefree = 0, op_static = 0, op_folded = 0, op_moresib = 0, op_spare = 0, op_flags = 65 'A', op_private = 0 '\\000', op_first = 0x0, op_other = 0x7ffd7a15af50}\nmethod_op = {op_next = 0x0, op_sibparent = 0x7f67bea55b00, op_ppaddr = 0xa, op_targ = 140083443869012, op_type = 32, op_opt = 0, op_slabbed = 0, op_savefree = 0, op_static = 0, op_folded = 1, op_moresib = 1, op_spare = 1, op_flags = 188 '\\274', op_private = 191 '\\277', op_u = {op_first = 0x7f67bfe12d68 \u003cPL_stack_base\u003e,\nop_meth_sv = 0x7f67bfe12d68 \u003cPL_stack_base\u003e}, op_rclass_sv = 0x7f67bfe0c460 \u003cPL_curstackinfo\u003e}\noldmark = 0\nretval = 0\noldcatch = \u003coptimized out\u003e\nret = \u003coptimized out\u003e\noldop = 0x55fdd6b0f628\ncur_env = {je_prev = 0x7ffd7a15b2f0, je_buf = {{__jmpbuf = {140083577537352, -6949195015966229981, 140726651694928, 94548424236768, 94548548174888, 94549068978416, -3778981178958480861, -3838237311138596317}, __mask_was_saved = 0, __saved_mask = {__val = {8, 0, 0, 140083572280529, 94548424157360, 94548748072944, 0,\n94545115086848, 94548716614672, 46, 94548716684952, 140080358359040, 140726651695248, 94548717023184, 0, 17865240150343261440}}}}, je_ret = 0, je_mustcatch = false, je_old_delaymagic = 0, je_old_stack_hwm = 2}\n__PRETTY_FUNCTION__ = \"Perl_call_sv\"\n#13 0x00007f67bf92a320 in S_curse (sv=sv@entry=0x55fdebab98f0, check_refcnt=check_refcnt@entry=true) at sv.c:6938\ntmpref = \u003coptimized out\u003e\ndestructor = 0x55fdebbdb7b0\nmeta = \u003coptimized out\u003e\nsp = \u003coptimized out\u003e\nstash = 0x55fdeb91a6d8\n__PRETTY_FUNCTION__ = \"S_curse\"\n#14 0x00007f67bf92ad52 in Perl_sv_clear (orig_sv=orig_sv@entry=0x55fdfcff1788) at sv.c:6532\nstash = \u003coptimized out\u003e\ntype = 12\nsv_type_details = \u003coptimized out\u003e\niter_sv = \u003coptimized out\u003e\nnext_sv = 0x0\nsv = 0x55fdebab98f0\nhash_index = 2\n__PRETTY_FUNCTION__ = \"Perl_sv_clear\"\n#15 0x00007f67bf92be95 in Perl_sv_free2 (sv=0x55fdfcff1788, rc=\u003coptimized out\u003e) at sv.c:7039\n__PRETTY_FUNCTION__ = \"Perl_sv_free2\"\n#16 0x00007f67bf986f2e in Perl_leave_scope (base=\u003coptimized out\u003e) at scope.c:1191\nsv = 0x55fdd6e21fa0\ni = \u003coptimized out\u003e\nsvp = 0x55fdd6e2e0c8\nuv = \u003coptimized out\u003e\na2 = \u003coptimized out\u003e\ntype = \u003coptimized out\u003e\na0 = \u003coptimized out\u003e\nap = \u003coptimized out\u003e\na1 = \u003coptimized out\u003e\nwas = false\n__PRETTY_FUNCTION__ = \"Perl_leave_scope\"\n#17 0x00007f67bf9215b3 in Perl_pp_leavesub () at pp_hot.c:4904\ngimme = \u003coptimized out\u003e\ncx = 0x55fdfcc5cad0\n---Type \u003creturn\u003e to continue, or q \u003creturn\u003e to quit---\noldsp = \u003coptimized out\u003e\nretop = \u003coptimized out\u003e\n__PRETTY_FUNCTION__ = \"Perl_pp_leavesub\"\n#18 0x00007f67bf8dd2c7 in Perl_runops_debug () at dump.c:2536\norig_stack_hwm = 6\n#19 0x00007f67bf850a15 in S_run_body (oldscope=1) at perl.c:2689\nNo locals.\n#20 perl_run (my_perl=\u003coptimized out\u003e) at perl.c:2617\noldscope = 1\nret = \u003coptimized out\u003e\ncur_env = {je_prev = 0x7f67bfe12b80 \u003cPL_start_env\u003e, je_buf = {{__jmpbuf = {0, -6949283977353299421, 94548399308400, 140726651696416, 0, 0, -3778981179939947997, -3838237300013729245}, __mask_was_saved = 0, __saved_mask = {__val = {94548424136416, 94548424136448, 94548424136480, 94548424136512, 94548424136544,\n94548424136576, 94548424136608, 140083577536536, 140083579758232, 17865240150343261440, 140726651696416, 140083577536536, 139637976727552, 0, 140726651696416, 17865240150343261440}}}}, je_ret = 3, je_mustcatch = false, je_old_delaymagic = 0, je_old_stack_hwm = 0}\n__PRETTY_FUNCTION__ = \"perl_run\"\n#21 0x000055fdc3c13e5b in main (argc=\u003coptimized out\u003e, argv=\u003coptimized out\u003e, env=\u003coptimized out\u003e) at perlmain.c:122\nexitstatus = \u003coptimized out\u003e\ni = \u003coptimized out\u003e\n(gdb)\n```","files":null}]}