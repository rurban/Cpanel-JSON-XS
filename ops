{"version":1,"ops":[{"type":1,"author":{"id":"d83177b0ff6be7dff4c88512860987ec93143bd0"},"timestamp":1486933417,"metadata":{"github-id":"MDU6SXNzdWUyMDcwNzg3MzE=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/80","origin":"github"},"title":"CLONE broken in latest version (3.0226)","message":"After upgrading to 3.0226 the following code no longer works:\n\n    #!/usr/bin/env perl\n    use forks;\n    use 5.010;\n    use strict;\n    use warnings;\n\n    use JSON::MaybeXS;\n\n    my $thread = threads-\u003enew( sub {\n        say encode_json({a =\u003e 1, b =\u003e 2});\n    } );\n    $thread-\u003ejoin;\n\nIt produces the following error:\n\n    Usage: Cpanel::JSON::XS::CLONE() at /tmp/perlbrew/perls/perl-5.24/lib/site_perl/5.24.1/darwin-thread-multi-2level/forks.pm line 3746.\n\nDowngrading back to 3.0225, it works as expected:\n\n    {\"b\":2,\"a\":1}\n\nperl -V\n\n    Summary of my perl5 (revision 5 version 24 subversion 1) configuration:\n    \n    Platform:\n        osname=darwin, osvers=15.6.0, archname=darwin-thread-multi-2level\n        uname='darwin mac.sw 15.6.0 darwin kernel version 15.6.0: wed nov 2 20:30:56 pdt 2016; root:xnu-3248.60.11.1.2~2release_x86_64 x86_64 '\n        config_args='-de -Dprefix=/Users/y/sw/perlbrew/perls/perl-5.24 -Dusethreads -Aeval:scriptdir=/Users/y/sw/perlbrew/perls/perl-5.24/bin'\n        hint=recommended, useposix=true, d_sigaction=define\n        useithreads=define, usemultiplicity=define\n        use64bitint=define, use64bitall=define, uselongdouble=undef\n        usemymalloc=n, bincompat5005=undef\n    Compiler:\n        cc='cc', ccflags ='-fno-common -DPERL_DARWIN -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/sw/include -I/opt/sw/include',\n        optimize='-O3',\n        cppflags='-fno-common -DPERL_DARWIN -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/sw/include -I/opt/sw/include'\n        ccversion='', gccversion='4.2.1 Compatible Apple LLVM 8.0.0 (clang-800.0.42.1)', gccosandvers=''\n        intsize=4, longsize=8, ptrsize=8, doublesize=8, byteorder=12345678, doublekind=3\n        d_longlong=define, longlongsize=8, d_longdbl=define, longdblsize=16, longdblkind=3\n        ivtype='long', ivsize=8, nvtype='double', nvsize=8, Off_t='off_t', lseeksize=8\n        alignbytes=8, prototype=define\n    Linker and Libraries:\n        ld='env MACOSX_DEPLOYMENT_TARGET=10.3 cc', ldflags =' -fstack-protector-strong -L/usr/sw/lib -L/opt/sw/lib'\n        libpth=/usr/sw/lib /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/bin/../lib/clang/8.0.0/lib /Applications/Xcode.app/Contents/Developer/Toolchains/XcodeDefault.xctoolchain/usr/lib /usr/lib /opt/sw/lib\n        libs=-lpthread -lgdbm -ldbm -ldl -lm -lutil -lc\n        perllibs=-lpthread -ldl -lm -lutil -lc\n        libc=, so=dylib, useshrplib=false, libperl=libperl.a\n        gnulibc_version=''\n    Dynamic Linking:\n        dlsrc=dl_dlopen.xs, dlext=bundle, d_dlsymun=undef, ccdlflags=' '\n        cccdlflags=' ', lddlflags=' -bundle -undefined dynamic_lookup -L/usr/sw/lib -L/opt/sw/lib -fstack-protector-strong'\n\n\n    Characteristics of this binary (from libperl): \n    Compile-time options: HAS_TIMES MULTIPLICITY PERLIO_LAYERS\n                            PERL_COPY_ON_WRITE PERL_DONT_CREATE_GVSV\n                            PERL_HASH_FUNC_ONE_AT_A_TIME_HARD\n                            PERL_IMPLICIT_CONTEXT PERL_MALLOC_WRAP\n                            PERL_PRESERVE_IVUV USE_64_BIT_ALL USE_64_BIT_INT\n                            USE_ITHREADS USE_LARGE_FILES USE_swE\n                            USE_swE_COLLATE USE_swE_CTYPE\n                            USE_swE_NUMERIC USE_swE_TIME USE_PERLIO\n                            USE_PERL_ATOF USE_REENTRANT_API\n    Built under darwin\n    Compiled at Jan 14 2017 20:22:44\n    %ENV:\n        PERL5LIB=\"\"\n        PERLBREW_BASHRC_VERSION=\"0.78\"\n        PERLBREW_HOME=\"/Users/y/.perlbrew\"\n        PERLBREW_MANPATH=\"/Users/y/sw/perlbrew/perls/perl-5.24/man\"\n        PERLBREW_PATH=\"/Users/y/sw/perlbrew/bin:/Users/y/sw/perlbrew/perls/perl-5.24/bin\"\n        PERLBREW_PERL=\"perl-5.24\"\n        PERLBREW_ROOT=\"/Users/y/sw/perlbrew\"\n        PERLBREW_VERSION=\"0.78\"\n        PERL_CPANM_OPT=\"-q\"\n    @INC:\n        /Users/y/sw/perl5\n        /Users/y/sw/perlbrew/perls/perl-5.24/lib/site_perl/5.24.1/darwin-thread-multi-2level\n        /Users/y/sw/perlbrew/perls/perl-5.24/lib/site_perl/5.24.1\n        /Users/y/sw/perlbrew/perls/perl-5.24/lib/5.24.1/darwin-thread-multi-2level\n        /Users/y/sw/perlbrew/perls/perl-5.24/lib/5.24.1\n        /Users/y/sw/perlbrew/perls/perl-5.24/lib/site_perl\n        .","files":null}]}