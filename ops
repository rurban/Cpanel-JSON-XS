{"version":1,"ops":[{"type":3,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1364492835,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDE1NjAzNDM3","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/6#issuecomment-15603437"},"message":"See the new testcases in https://github.com/rurban/Cpanel-JSON-XS/commit/010707d49a81b5ea30e8e3388753c74f9121e0e7\n\nI see no double-encoding problem in JSON::XS (nor Cpanel::JSON::XS) with or without \nthe utf8 pragma set, same for -C or not -C set.\nOf course you may double encode the perl string, but that's no JSON::XS problem then.\n\n```\nuse utf8;\nmy $love = $] \u003c 5.008 ? \"I \\342\\235\\244 perl\" : \"I ❤ perl\";\nis(Cpanel::JSON::XS-\u003enew-\u003eascii-\u003eencode ([$love]),\n   $] \u003c 5.008 ? '[\"I \\u00e2\\u009d\\u00a4 perl\"]' : '[\"I \\u2764 perl\"]', 'utf8 enc ascii');\nis(Cpanel::JSON::XS-\u003enew-\u003elatin1-\u003eencode ([$love]),\n      $] \u003c 5.008 ? \"[\\\"I \\342\\235\\244 perl\\\"]\" : '[\"I \\u2764 perl\"]', 'utf8 enc latin1');\n\nSKIP: {\n  skip \"5.6\", 1 if $] \u003c 5.008;\n  require Encode;\n  # [RT #84244] complaint: JSON::XS double encodes to [\"I â¤ perl\"]\n  #                and with utf8 triple encodes it to [\"I Ã¢ÂÂ¤ perl\"]\n  my $s = Encode::decode_utf8($love);\n  is(Cpanel::JSON::XS-\u003enew-\u003eutf8-\u003eencode ([$s]), \"[\\\"I \\342\\235\\244 perl\\\"]\", 'utf8 enc utf8 [RT #84244]');\n}\nis(Cpanel::JSON::XS-\u003enew-\u003ebinary-\u003eencode ([$love]), '[\"I \\xe2\\x9d\\xa4 perl\"]', 'utf8 enc binary');\n```\n\nand without:\n\n```\nno utf8;\nis(Cpanel::JSON::XS-\u003enew-\u003eascii-\u003eencode ([\"I ❤ perl\"]),\n   '[\"I \\\\u00e2\\\\u009d\\\\u00a4 perl\"]', 'non-utf8 enc ascii');\nis(Cpanel::JSON::XS-\u003enew-\u003eascii-\u003edecode ('[\"I \\\\u00e2\\\\u009d\\\\u00a4 perl\"]')-\u003e[0],\n   \"I \\x{e2}\\x{9d}\\x{a4} perl\", 'non-utf8 dec ascii');\n\nis(Cpanel::JSON::XS-\u003enew-\u003elatin1-\u003eencode ([\"I \\x{e2}\\x{9d}\\x{a4} perl\"]),\n   \"[\\\"I \\x{e2}\\x{9d}\\x{a4} perl\\\"]\", 'non-utf8 enc latin1');\nis(Cpanel::JSON::XS-\u003enew-\u003elatin1-\u003edecode (\"[\\\"I \\x{e2}\\x{9d}\\x{a4} perl\\\"]\")-\u003e[0],\n   \"I \\x{e2}\\x{9d}\\x{a4} perl\", 'non-utf8 dec latin1');\n\nSKIP: {\n  skip \"5.6\", 2 if $] \u003c 5.008;\n  require Encode;\n  # [RT #84244] complaint: JSON::XS double encodes to [\"I â perl\"]\n  is(Cpanel::JSON::XS-\u003enew-\u003eutf8-\u003eencode ([Encode::decode_utf8(\"I \\x{e2}\\x{9d}\\x{a4} perl\")]),\n     \"[\\\"I \\x{e2}\\x{9d}\\x{a4} perl\\\"]\", 'non-utf8 enc utf8 [RT #84244]');\n  is(Cpanel::JSON::XS-\u003enew-\u003eutf8-\u003edecode (\"[\\\"I \\x{e2}\\x{9d}\\x{a4} perl\\\"]\")-\u003e[0],\n     Encode::decode_utf8(\"I \\x{e2}\\x{9d}\\x{a4} perl\"), 'non-utf8 dec utf8');\n}\n\nis(Cpanel::JSON::XS-\u003enew-\u003ebinary-\u003eencode ([\"I \\x{e2}\\x{9d}\\x{a4} perl\"]),\n   '[\"I \\xe2\\x9d\\xa4 perl\"]', 'non-utf8 enc binary');\nis(Cpanel::JSON::XS-\u003enew-\u003ebinary-\u003edecode ('[\"I \\xe2\\x9d\\xa4 perl\"]')-\u003e[0],\n   \"I \\x{e2}\\x{9d}\\x{a4} perl\", 'non-utf8 dec binary');\n```","files":null},{"type":4,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1364492835,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50NDMzMzAxMjA="},"status":2}]}