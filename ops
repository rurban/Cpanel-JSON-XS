{"version":1,"ops":[{"type":6,"author":{"id":"ec8d29670ff994e79f210384ff8c7a951a66abe8"},"timestamp":1545216617,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDE2NDIzNzY3Ng=="},"target":"97f89cc311dc19bb4c677be72d378c7b73613440bacda65f0445f676f5ecb857","message":"`encode_json()` doesn't seem to properly escape control characters. Consider the following input:\n```perl\nmy $sJsonString = encode_json({foo =\u003e \"bar\\nbaz\"});\n```\nI'd expect `$sJsonString` to be\n```json\n{\"foo\":\"bar\\\\nbaz\"}\n```\nbut this is apparently not the case, if I redirect `$sJsonString` to a file, I'm actually getting\n```json\n{\"foo\":\"bar\\nbaz\"}\n```\nwhich then makes `JSON.parse()` complain, that I have a \"bad control character in string literal\".\n\nIf I use single quotes\n```perl\nmy $sJsonString = encode_json({foo =\u003e 'bar\\nbaz'});\n```\nI do get the properly escaped `{\"foo\":\"bar\\\\nbaz\"}` back.","files":null},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1550222338,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDIxNDE5MjU4OTU="},"added":["invalid"],"removed":[]},{"type":3,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1550222525,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ2Mzk2NjA5OQ==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/119#issuecomment-463966099"},"message":"Not a bug. JSON must not mangle the string representation, even if the \\n is unfortunate and breaks many JSON readers.\nYou might want to replace a \\n with the +U000A representation instead, or quote it manually. That's what I usually do.","files":null},{"type":3,"author":{"id":"61d29c699221d2f311671dd3d212ea6983677610"},"timestamp":1553781456,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ3NzYwNTg2OQ==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/119#issuecomment-477605869"},"message":"\u003e JSON must not mangle the string representation, even if the \\n is unfortunate and breaks many JSON readers.\n\nI don't think this matches the RFC?\n\n\u003e All Unicode characters may be placed within the\n\u003e  quotation marks, except for the characters that MUST be escaped:\n\u003e   quotation mark, reverse solidus, and the control characters (U+0000\n\u003e   through U+001F).\n\nAs a control character, `\\n` (U+0012) **must** be escaped for an RFC4627/RFC7159/RFC8259-compliant encoder.\n\nhttps://tools.ietf.org/html/rfc8259#section-7\n\nAccording to the wording in that section, JSON **must** \"mangle\" the string representation, and indeed there is already [precedent for this in Cpanel::JSON::XS](https://metacpan.org/pod/Cpanel::JSON::XS#$json-=-$json-%3Eescape_slash-([$enable])).\n\n(same wording dates back to https://tools.ietf.org/html/rfc4627, although RFC8259 was updated to emphasise more strongly).","files":null},{"type":3,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553782015,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ3NzYwNjU1OQ==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/119#issuecomment-477606559"},"message":"Oh cool. Thanks for insisting. I hate line-wrapping json strings.","files":null},{"type":6,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553782015,"metadata":{"github-id":"MDE1OlVzZXJDb250ZW50RWRpdDIwMjQwOTQwMQ=="},"target":"48ccf5951e6e7601832f509f10a9a72d1e8a294018e77281ea5fde9cf1f6b986","message":"It is escaped once. You want it escaped twice.\nThat would be a fundamental change, I'll have to check other JSON encoders, and it needs to be fixed upstream an JSON::PP first. All perl JSON encoders escape it once, not twice.\n\n`perl -MJSON::PP -e'print encode_json({foo =\u003e \"bar\\nbaz\"})' =\u003e {\"foo\":\"bar\\nbaz\"}`\n`perl -MJSON::XS -e'print encode_json({foo =\u003e \"bar\\nbaz\"})' =\u003e {\"foo\":\"bar\\nbaz\"}`\n`perl -MMojo::JSON=encode_json -e'print encode_json({foo =\u003e \"bar\\nbaz\"})'`","files":null},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553781565,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDIyMzYzNTkzOTM="},"added":["bug"],"removed":[]},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553781565,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50MjIzNjM1OTM5NQ=="},"added":[],"removed":["invalid"]},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553782027,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDIyMzYzODM3ODk="},"added":["questionable"],"removed":[]},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553782037,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDIyMzYzODQyOTU="},"added":["upstream"],"removed":[]},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1553782037,"metadata":{"github-id":"MDE0OlVubGFiZWxlZEV2ZW50MjIzNjM4NDI5OQ=="},"added":[],"removed":["bug"]},{"type":3,"author":{"id":"3a201a2fd368c2b765e2627259bbf90472dd9990"},"timestamp":1555488912,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ4Mzk4NDgzMg==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/119#issuecomment-483984832"},"message":"`jq` behaves the same:\n```\n$ echo '{\"x\":\"a\\u000Ab\"}' | jq \"\"\n{\n  \"x\": \"a\\nb\"\n}\n$ echo '{\"x\":\"a\\nb\"}' | jq \"\"\n{\n  \"x\": \"a\\nb\"\n}\n```","files":null},{"type":4,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1596633661,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MzYyNDY0MzYzOA=="},"status":2},{"type":5,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1596633685,"metadata":{"github-id":"MDEyOkxhYmVsZWRFdmVudDM2MjQ2NDU1MzI="},"added":["invalid"],"removed":[]}]}