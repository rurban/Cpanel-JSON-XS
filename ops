{"version":1,"ops":[{"type":1,"author":{"id":"23fe973b8c75ff8170318fc8a2c8cb43c5291f93"},"timestamp":1618008487,"metadata":{"github-id":"MDU6SXNzdWU4NTQ5MDMzNzc=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/177","origin":"github"},"title":"Build-time failure: g++9 / FreeBSD-12","message":"Today I had occasion to try to install a CPAN library (Devel-NYTProf) on FreeBSD-12 using g++-9.3.0 as the C-compiler with which the associated `perl` was compiled.  Similar attempts on this machine with clang10 and gcc9 were successful.  But with g++-9 I got:\n```\n[perlmonger: Cpanel-JSON-XS-4.25] $ uname -mrs\nFreeBSD 12.2-STABLE amd64\n\n$ thisperl -v | head -2 | tail -1\nThis is perl 5, version 32, subversion 1 (v5.32.1) built for amd64-freebsd-thread-multi\n\n$ thisperl -V:config_args; thisperl -V:cc\nconfig_args='-des -Dusedevel -Uversiononly -Dprefix=/usr/home/jkeenan/testing/g++9/v5.32.1 -Dman1dir=none -Dman3dir=none -Duseithreads -Doptimize=-O2 -pipe -fstack-protector -fno-strict-aliasing -des -Dusedevel -Dusethreads -Dcc=g++9';\ncc='g++9';\n\n$ thisperl Makefile.PL\nGenerating a Unix-style Makefile\nWriting Makefile for Cpanel::JSON::XS\nWriting MYMETA.yml and MYMETA.json\n\n$ make\nSkip blib/lib/Cpanel/JSON/XS/Type.pm (unchanged)\nSkip blib/lib/Cpanel/JSON/XS/Boolean.pm (unchanged)\nSkip blib/lib/Cpanel/JSON/XS.pm (unchanged)\nRunning Mkbootstrap for XS ()\nchmod 644 \"XS.bs\"\n\"/usr/home/jkeenan/testing/g++9/v5.32.1/bin/perl\" -MExtUtils::Command::MM -e 'cp_nonempty' -- XS.bs blib/arch/auto/Cpanel/JSON/XS/XS.bs 644\ng++9 -c    -DHAS_FPSETMASK -DHAS_FLOATINGPOINT_H -fwrapv -fno-strict-aliasing -pipe -fstack-protector-strong -I/usr/local/include -D_FORTIFY_SOURCE=2 -O2 -pipe -fstack-protector -fno-strict-aliasing    -DVERSION=\\\"4.25\\\"  -DXS_VERSION=\\\"4.25\\\" -DPIC -fPIC \"-I/usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE\"  -Wall -Werror=declaration-after-statement -Wextra -W XS.c\ncc1plus: warning: '-Werror=' argument '-Werror=declaration-after-statement' is not valid for C++\nIn file included from /usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/perl.h:5606,\n                 from XS.xs:3:\nXS.xs: In function 'UV decode_utf8(PerlInterpreter*, unsigned char*, STRLEN, int, STRLEN*)':\n/usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/embed.h:737:66: warning: 'UV Perl_utf8n_to_uvuni(PerlInterpreter*, const U8*, STRLEN, STRLEN*, U32)' is deprecated [-Wdeprecated-declarations]\n  737 | #define utf8n_to_uvuni(a,b,c,d) Perl_utf8n_to_uvuni(aTHX_ a,b,c,d)\n      |                                                                  ^\nXS.xs:539:12: note: in expansion of macro 'utf8n_to_uvuni'\n  539 |     UV c = utf8n_to_uvuni (s, len, clen,\n      |            ^~~~~~~~~~~~~~\nIn file included from /usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/perl.h:5567,\n                 from XS.xs:3:\n/usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/proto.h:3989:18: note: declared here\n 3989 | PERL_CALLCONV UV Perl_utf8n_to_uvuni(pTHX_ const U8 *s, STRLEN curlen, STRLEN *retlen, U32 flags)\n      |                  ^~~~~~~~~~~~~~~~~~~\nIn file included from /usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/perl.h:5606,\n                 from XS.xs:3:\n/usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/embed.h:737:66: warning: 'UV Perl_utf8n_to_uvuni(PerlInterpreter*, const U8*, STRLEN, STRLEN*, U32)' is deprecated [-Wdeprecated-declarations]\n  737 | #define utf8n_to_uvuni(a,b,c,d) Perl_utf8n_to_uvuni(aTHX_ a,b,c,d)\n      |                                                                  ^\nXS.xs:539:12: note: in expansion of macro 'utf8n_to_uvuni'\n  539 |     UV c = utf8n_to_uvuni (s, len, clen,\n      |            ^~~~~~~~~~~~~~\nIn file included from /usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/perl.h:5567,\n                 from XS.xs:3:\n/usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/proto.h:3989:18: note: declared here\n 3989 | PERL_CALLCONV UV Perl_utf8n_to_uvuni(pTHX_ const U8 *s, STRLEN curlen, STRLEN *retlen, U32 flags)\n      |                  ^~~~~~~~~~~~~~~~~~~\nXS.xs: In function 'void encode_hv(PerlInterpreter*, enc_t*, HV*, SV*)':\nXS.xs:1361:46: error: invalid conversion from 'void*' to 'HEK*' {aka 'hek*'} [-fpermissive]\n 1361 |                   he1-\u003ehent_hek = safecalloc (1, sizeof (struct hek) + sizeof (SV*) + 2);\nIn file included from /usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/perl.h:5606,\n                 from XS.xs:3:\nXS.xs: In function 'void XS_Cpanel__JSON__XS_incr_parse(PerlInterpreter*, CV*)':\nXS.xs:4911:60: warning: type qualifiers ignored on cast result type [-Wignored-qualifiers]\n 4911 |               sv_chop (self-\u003eincr_text, (const char* const)endp);\n      |                                                            ^~~~\n/usr/home/jkeenan/testing/g++9/v5.32.1/lib/perl5/5.32.1/amd64-freebsd-thread-multi/CORE/embed.h:575:44: note: in definition of macro 'sv_chop'\n  575 | #define sv_chop(a,b)  Perl_sv_chop(aTHX_ a,b)\n      |                                            ^\n*** Error code 1\n\nStop.\nmake: stopped in /usr/home/jkeenan/.cpanm/work/1618007847.6775/Cpanel-JSON-XS-4.25\n```\nCan you investigate?\n\nThank you very much.\nJim Keenan","files":null}]}