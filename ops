{"version":1,"ops":[{"type":1,"author":{"id":"c004f80c5e688a13aff028e467e6e5cd8c3e2250"},"timestamp":1529424455,"metadata":{"github-id":"MDU6SXNzdWUzMzM3Mzk2OTI=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/111","origin":"github"},"title":"Decoding problem for bencoded utf8 input in the cpanel_json_xs executable","message":"Hello.\nIt's more of a problem with the Convert::Bencode backend module, but I am hoping something might be done anyway to solve the problem with cpanel_json_xs.\nBasically as of now Convert::Bencode is interpreting the length of strings as a count of bytes instead of a count of characters.\nTherefore things break with multibyte characters.\nExamples below (with a utf-8 locale):\n```\n$ echo -n 'd1:f4:ledie' | cpanel_json_xs -f bencode -t json-utf-8\n{\"f\":\"ledi\"}\n\n$ echo -n 'd1:f4:ledìe' | cpanel_json_xs -f bencode -t json-utf-8\nUse of uninitialized value $item in string ne at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 134, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 127, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 138, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 148, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in pattern match (m//) at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 157, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 127, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 138, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 148, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in pattern match (m//) at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 157, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string ne at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 134, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 127, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 138, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 148, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in pattern match (m//) at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 157, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 127, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 138, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 148, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in pattern match (m//) at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 157, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string ne at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 134, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 127, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 138, \u003cSTDIN\u003e line 1.\nUse of uninitialized value $item in string eq at /usr/local/share/perl/5.18.2/Convert/Bencode.pm line 148, \u003cSTDIN\u003e line 1.\n```\nThe implementation used by Net::BitTorrent::Protocol::BEP03::Bencode, for instance, works as expected.\nFor example:\n```\necho -n 'd1:f4:ledìe' | perl  -MNet::BitTorrent::Protocol::BEP03::Bencode=bdecode -MCpanel::JSON::XS -wnE 'utf8::decode $_;print encode_json bdecode $_'\n{\"f\":\"ledì\"}\n```\nThanks.","files":null}]}