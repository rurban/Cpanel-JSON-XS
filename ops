{"version":1,"ops":[{"type":3,"author":{"id":"5641180e906e09e22a3b23418569b280afb8221c"},"timestamp":1559860963,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDQ5OTY5NDY1Ng==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/132#issuecomment-499694656"},"message":"Hi! I have a snippet that reproduces these errors. Although based on what you said above regarding PVs, I'm not sure how real a problem this is. What do you think?\n\nThank you!\n\n```perl\n$ cat test.pl\nuse strict;\nuse warnings;\n\nuse Cpanel::JSON::XS qw( decode_json encode_json );\n\nmy $h = {\n    a =\u003e 1.0,\n};\nmy $j = encode_json($h);\nprint $j . \"\\n\";\n```\n\n```\n$ valgrind /opt/perl5.28.2/bin/perl test.pl\n[snip]\n==432== Using Valgrind-3.13.0 and LibVEX; rerun with -h for copyright info\n[snip]\n==432== Conditional jump or move depends on uninitialised value(s)\n==432==    at 0x6311616: encode_sv (XS.xs:1848)\n==432==    by 0x6314F3A: encode_hv (XS.xs:1319)\n==432==    by 0x63119BA: encode_sv (XS.xs:1703)\n==432==    by 0x6318608: encode_json (XS.xs:2130)\n==432==    by 0x6318C0A: XS_Cpanel__JSON__XS_encode_json (XS.xs:4433)\n==432==    by 0x24AD25: Perl_pp_entersub (pp_hot.c:5232)\n==432==    by 0x206B41: Perl_runops_debug (dump.c:2536)\n==432==    by 0x17A4E3: S_run_body (perl.c:2694)\n==432==    by 0x17A4E3: perl_run (perl.c:2617)\n==432==    by 0x143C31: main (perlmain.c:122)\n==432==\n==432== Conditional jump or move depends on uninitialised value(s)\n==432==    at 0x6311624: encode_sv (XS.xs:1869)\n==432==    by 0x6314F3A: encode_hv (XS.xs:1319)\n==432==    by 0x63119BA: encode_sv (XS.xs:1703)\n==432==    by 0x6318608: encode_json (XS.xs:2130)\n==432==    by 0x6318C0A: XS_Cpanel__JSON__XS_encode_json (XS.xs:4433)\n==432==    by 0x24AD25: Perl_pp_entersub (pp_hot.c:5232)\n==432==    by 0x206B41: Perl_runops_debug (dump.c:2536)\n==432==    by 0x17A4E3: S_run_body (perl.c:2694)\n==432==    by 0x17A4E3: perl_run (perl.c:2617)\n==432==    by 0x143C31: main (perlmain.c:122)\n[snip]\n```","files":null},{"type":4,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1559883542,"metadata":{"github-id":"MDEzOlJlb3BlbmVkRXZlbnQyMzk2MjQwNTU3"},"status":1},{"type":3,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1560172635,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUwMDQxMzAwNQ==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/132#issuecomment-500413005"},"message":"I'm afraid, I still cannot reproduce it with all your versions, and latest 4.12. But we fixed two bugs there lately.\n\nAnd it's the same location: memcmp against \"nan\" of a buffer which is probably too small, but the error can be ignored. `(UNLIKELY(strEQc(enc-\u003ecur, STR_NAN)))`","files":null},{"type":4,"author":{"id":"42b8049125821cad60d350df07d9d216b854f3f7"},"timestamp":1560172635,"metadata":{"github-id":"MDExOkNsb3NlZEV2ZW50MjQwMDkyOTQ3MA=="},"status":2},{"type":3,"author":{"id":"5641180e906e09e22a3b23418569b280afb8221c"},"timestamp":1560188894,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUwMDUxMjU0Nw==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/132#issuecomment-500512547"},"message":"I see. I was testing using 4.11 FWIW. Thanks for looking into it!","files":null},{"type":3,"author":{"id":"5641180e906e09e22a3b23418569b280afb8221c"},"timestamp":1560358272,"metadata":{"github-id":"MDEyOklzc3VlQ29tbWVudDUwMTM2MTU5Nw==","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/132#issuecomment-501361597"},"message":"Something interesting I discovered:\n\nI'm not sure what to make of this, but the error doesn't show up using valgrind 3.14.0 or 3.15.0. I do see it using valgrind 3.13.0. I used Perl 5.30.0 and 4.12 of this module when testing this time.\n\nI suppose valgrind could have fixed a bug to not show this, or maybe there is a new bug hiding it. The use of memcmp() seems not correct to me though. But my knowledge of the PV stuff is nil :sweat_smile:.\n\nI tried building Perl with clang 7's memory sanitizer to see if that finds it, but it errors out before Configure completes. I haven't figured that out.","files":null}]}