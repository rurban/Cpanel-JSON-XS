{"version":1,"ops":[{"type":1,"author":{"id":"25d2f86c16f2d88fc7e70008cbc3245fd81962e9"},"timestamp":1590490966,"metadata":{"github-id":"MDU6SXNzdWU2MjQ3OTcxMTM=","github-url":"https://github.com/rurban/Cpanel-JSON-XS/issues/165","origin":"github"},"title":"inf/nan detection on aix","message":"I have experienced the following failure when trying to build Cpanel-JSON-XS-4.19 on AIX\n\n    AIX 7.2 TL 4\n    compiler: IBM XL C/C++ for AIX, V12.1 (5765-J02, 5725-C72) Version: 12.01.0000.0017\n    perl-5.20.1 (osname=aix, osvers=6.1.0.0, archname=aix-thread-multi)\n\nThe failure looks like this\n\n```\n[0:t72] /home/perl_ph/.cpan/build/Cpanel-JSON-XS-4.19-2 $ perl Makefile.PL\nprobe for xlocale.h... \"tmp.c\", line 2.10: 1506-296 (S) #include file \u003cxlocale.h\u003e not found.\n\"tmp.c\", line 5.25: 1506-275 (S) Unexpected text integer constant encountered.\n\"tmp.c\", line 5.15: 1506-045 (S) Undeclared identifier locale_t.\nnot found\nxlc_r -q32 -D_ALL_SOURCE -D_ANSI_C_SOURCE -D_POSIX_SOURCE -qmaxmem=-1 -qnoansialias -qlanglvl=extc99 -DUSE_NATIVE_DLOPEN -DNEED_PTHREAD_INIT -q32 -D_LARGE_FILES -o tmp  -brtl -bdynamic -b32 tmp.c -lbind -lnsl -ldbm -ldl -lld -lm -lcrypt -lpthreads -lc\nChecking if your kit is complete...\nLooks good\nGenerating a Unix-style Makefile\nWriting Makefile for Cpanel::JSON::XS\nWriting MYMETA.yml and MYMETA.json\n[0:t72] /home/perl_ph/.cpan/build/Cpanel-JSON-XS-4.19-2 $ make\ncp XS/Boolean.pm blib/lib/Cpanel/JSON/XS/Boolean.pm\ncp XS/Type.pm blib/lib/Cpanel/JSON/XS/Type.pm\ncp XS.pm blib/lib/Cpanel/JSON/XS.pm\nRunning Mkbootstrap for XS ()\n        chmod 644 \"XS.bs\"\n         \"/usr/bin/perl\" -MExtUtils::Command::MM -e 'cp_nonempty' -- XS.bs blib/arch/auto/Cpanel/JSON/XS/XS.bs 644\n        \"/usr/bin/perl\" \"/usr/opt/perl5/lib/5.20.1/ExtUtils/xsubpp\"  -typemap '/usr/opt/perl5/lib/5.20.1/ExtUtils/typemap' -typemap '/home/perl_ph/.cpan/build/Cpanel-JSON-XS-4.19-2/typemap'  XS.xs \u003e XS.xsc\n        mv XS.xsc XS.c\n        xlc_r -q32 -c    -D_ALL_SOURCE -D_ANSI_C_SOURCE -D_POSIX_SOURCE -qmaxmem=-1 -qnoansialias -qlanglvl=extc99 -DUSE_NATIVE_DLOPEN -DNEED_PTHREAD_INIT -q32 -D_LARGE_FILES -O    -DVERSION=\\\"4.19\\\"  -DXS_VERSION=\\\"4.19\\\"  \"-I/usr/opt/perl5/lib/5.20.1/aix-thread-multi/CORE\"   XS.c\n        \"/usr/bin/perl\" -MExtUtils::Mksymlists  -e \"Mksymlists('NAME'=\u003e\\\"Cpanel::JSON::XS\\\", 'DLBASE' =\u003e 'XS', 'DL_FUNCS' =\u003e {  }, 'FUNCLIST' =\u003e [], 'IMPORTS' =\u003e {  }, 'DL_VARS' =\u003e []);\"\n        rm -f blib/arch/auto/Cpanel/JSON/XS/XS.so\n        ld  -bhalt:4 -G -bI:/usr/opt/perl5/lib/5.20.1/aix-thread-multi/CORE/perl.exp  -bnoentry -lpthreads -lc -lm -bE:XS.exp XS.o  -o blib/arch/auto/Cpanel/JSON/XS/XS.so        \n        chmod 755 blib/arch/auto/Cpanel/JSON/XS/XS.so\n        cp bin/cpanel_json_xs blib/script/cpanel_json_xs\n        \"/usr/bin/perl\" -MExtUtils::MY -e 'MY-\u003efixin(shift)' -- blib/script/cpanel_json_xs\nManifying 1 pod document\nManifying 3 pod documents\n[0:t72] /home/perl_ph/.cpan/build/Cpanel-JSON-XS-4.19-2 $ make test\n         \"/usr/bin/perl\" -MExtUtils::Command::MM -e 'cp_nonempty' -- XS.bs blib/arch/auto/Cpanel/JSON/XS/XS.bs 644\n        PERL_DL_NONLAZY=1 \"/usr/bin/perl\" \"-MExtUtils::Command::MM\" \"-MTest::Harness\" \"-e\" \"undef *Test::Harness::Switches; test_harness(0, 'blib/lib', 'blib/arch')\" -Mcommon::sense t/*.t\n...\nt/117_numbers.t ............ 1/25 \n#   Failed test 'inf -\u003e \"inf\" stringify_infnan(1)'\n#   at t/117_numbers.t line 73.\n#          got: '[INF.0]'\n#     expected: '[\"inf\"]'\n\n#   Failed test '-inf -\u003e \"-inf\"'\n#   at t/117_numbers.t line 73.\n#          got: '[-INF.0]'\n#     expected: '[\"-inf\"]'\n\n#   Failed test 'nan -\u003e \"nan\"'\n#   at t/117_numbers.t line 73.\n#          got: '[-NaNQ]'\n#     expected: '[\"NANQ\"]'\n\n#   Failed test '-nan -\u003e \"-nan\"'\n#   at t/117_numbers.t line 73.\n#          got: '[NaNQ]'\n#     expected: '[\"NANQ\"]'\n\n#   Failed test '-nan -\u003e \"-nan\"'\n#   at t/117_numbers.t line 73.\n#          got: '[NaNQ]'\n#     expected: '[\"NANQ\"]'\n\n#   Failed test 'inf stringify_infnan(2)'\n#   at t/117_numbers.t line 73.\n#          got: '[INF.0]'\n#     expected: '[inf]'\n\n#   Failed test '-inf'\n#   at t/117_numbers.t line 73.\n#          got: '[-INF.0]'\n#     expected: '[-inf]'\n\n#   Failed test 'nan'\n#   at t/117_numbers.t line 73.\n#          got: '[-NaNQ]'\n#     expected: '[NANQ]'\n\n#   Failed test '-nan'\n#   at t/117_numbers.t line 73.\n#          got: '[NaNQ]'\n#     expected: '[NANQ]'\n\n#   Failed test '-nan'\n#   at t/117_numbers.t line 73.\n#          got: '[NaNQ]'\n#     expected: '[NANQ]'\n\n#   Failed test 'inf stringify_infnan(3)'\n#   at t/117_numbers.t line 101.\n#          got: '[INF.0]'\n#     expected: '[\"inf\"]'\n\n#   Failed test '-inf'\n#   at t/117_numbers.t line 102.\n#          got: '[-INF.0]'\n#     expected: '[\"-inf\"]'\n\n#   Failed test 'nan'\n#   at t/117_numbers.t line 103.\n#          got: '[-NaNQ]'\n#     expected: '[\"nan\"]'\n\n#   Failed test 'nan or -nan'\n#   at t/117_numbers.t line 104.\n#          got: '[NaNQ]'\n#     expected: '[\"nan\"]'\n\n#   Failed test 'nan or -nan'\n#   at t/117_numbers.t line 105.\n#          got: '[NaNQ]'\n#     expected: '[\"nan\"]'\n# Looks like you failed 15 tests of 25.\n```","files":null}]}